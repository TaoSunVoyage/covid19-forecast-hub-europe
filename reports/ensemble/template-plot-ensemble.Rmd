```{r prediction-plots, echo = FALSE, results='asis', fig.width = 8.5, fig.height=14}

for (target_variable in target_variables) {
  cat("\n\n## ", target_variable,
      " {.tabset .tabset-fade .tabset-dropdown}\n\n")
      
  for (ago in agos) {
    cat(paste0("\n\n### ", ago, "\n\n"))
  
      filter_both <-
        list(paste0("target_variable %in% '", target_variable, "'")) 
      filter_truth <-
        list(paste0("target_end_date > '", as.Date(report_date) - 7 * 10, "'"), 
             paste0("target_end_date <= '", as.Date(report_date) + 7 * 4, "'"))
      filter_forecasts <- list(paste0("ago == '", ago, "'"))

      plot <- scoringutils::plot_predictions(data,
                                             x = "target_end_date",
                                             facet_formula = ~ location_name,
                                             ncol = 3, 
                                             filter_both = filter_both,
                                             filter_truth = filter_truth,
                                             filter_forecasts = filter_forecasts,
                                             allow_truth_without_pred = FALSE,
                                             zoom_multiple_data =
                                               c(ymin = 0, ymax = 3),
                                             expand_limits =
                                               list(x =
                                                      max(data$target_end_date),
                                                    y = 0),
                                             scales = "free") + 
        ggplot2::theme(legend.position = "bottom", 
                       strip.placement = "outside") +
        scale_y_continuous("True and predicted values", labels = scales::comma) +
        xlab("")
      
      print(plot)
  }
}



```
